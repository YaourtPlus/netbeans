<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Facelet Title</title>
        <ui:include src="/css.xhtml" />
    </h:head>
    <h:body>
        <ui:include src="/secured/navbar.xhtml"/>
        <!-- Div mur -->
        <h:panelGroup layout="block" class="container-fluid">
            <!-- Div Filous/Statuts/Messages -->
            <h:panelGroup layout="block" class="row" >
                <!-- Liste Filous -->
                <h:panelGroup layout="block" class="col-lg-2" style="#{not empty filousController.getFilous(murController.idUtilisateur) ? 'display : visible' : 'display : none'}"> 
                    <ul class="list-unstyled">
                        <ui:repeat value="#{filousController.getFilous(murController.idUtilisateur)}" var="filous" >
                            #{filous.id}
                            <li> <h:outputText value="#{filous.nom} #{filous.prenom}"/>
                                <h:form id="formRemoveFilous">
                                    <h:commandLink value="Supprimer" action="#{filousController.suppressionFilou(filous.id, murController.idUtilisateur)}" />
                                </h:form>
                            </li>
                        </ui:repeat>
                    </ul>
                </h:panelGroup> <!-- Fin Liste filous -->
                <!-- Form statut -->
                <h:panelGroup layout="block" class="post col-lg-6">
                    <!-- Form post statut -->
                    <h:form id="formStatut" enctype="multipart/form-data">
                        <h:inputTextarea rows="5" cols="150" id="statut" value="#{murController.statut}" required="false" requiredMessage="Ajouter un ptit statut"/>
                        <h:inputFile value="#{murController.part}"/>
                        <h:commandButton value="Publier" action="#{murController.ajoutFichier()}" />
                    </h:form><!-- Fin form post statut -->
                    <!-- Div liste statuts -->
                    <h:panelGroup layout="block">
                        <!-- Boucle sur liste des statuts -->
                        <ui:repeat value="#{murController.getStatuts()}" var="statut" >
                            <!-- Destinataire statut -->
                            <ui:param name="idDestinataire" value="#{empty statut.destinataire ? statut.auteur.id : statut.destinataire.id}" />
                            <!-- Div statut -->
                            <h:panelGroup layout="block" class="statuts">

                                <!-- Div info statut -->
                                <h:panelGroup layout="block" class="row">
                                    <!-- Div auteur statut -->
                                    <h:panelGroup layout="block" class="pull-left statut-left">
                                        <h:outputText value="#{statut.auteur.prenom} #{statut.auteur.nom}"/>
                                    </h:panelGroup><!-- Fin div auteur statut -->
                                    <!-- Div date statut -->
                                    <h:panelGroup layout="block" class="pull-right statut-right">
                                        <h:outputText value="#{statut.date}"/>
                                    </h:panelGroup><!-- Fin div date statut -->
                                </h:panelGroup><!-- Fin div info statut -->

                                <!-- Div texte statuts -->
                                <h:panelGroup layout="block" class="statuts-texte">
                                    <h:outputText value="#{statut.texte}"/>
                                </h:panelGroup> <!-- Fin div texte statuts -->

                                <!-- Div léger/lourd -->
                                <h:panelGroup layout="block" class="vote">
                                    <!-- Boucle liste fichiers -->
                                    <ui:repeat value="#{statut.listeFichiers}" var="fichier">
                                        <h:link value="#{fichier.contenu}" outcome="/files/#{fichier.nom}"/>
                                    </ui:repeat><!-- Boucle fin liste fichiers -->

                                    <!-- Affichage nombre léger/lourd -->
                                    <h:panelGroup layout="block" class="row">
                                        <ui:fragment rendered="#{statut.nbLeger > 1}">
                                            <h:outputText value="#{statut.nbLeger} legers"/>
                                        </ui:fragment>
                                        <ui:fragment rendered="#{!(statut.nbLeger > 1)}">
                                            <h:outputText value="#{statut.nbLeger} leger"/>
                                        </ui:fragment>

                                        <ui:fragment rendered="#{statut.nbLourd > 1}">
                                            <h:outputText value="#{statut.nbLourd} lourd"/>
                                        </ui:fragment>
                                        <ui:fragment rendered="#{!(statut.nbLourd > 1)}">
                                            <h:outputText value="#{statut.nbLourd} lourds"/>
                                        </ui:fragment>
                                    </h:panelGroup><!-- Fin affichage nombre léger/lourd -->

                                    <!-- Div lien not empty action statut-->
                                    <h:panelGroup layout="block" style="#{not empty statut.statutsActeurs ? 'display : visible' : 'display : none'}">

                                        <!-- Div lien action utilisateur statut -->
                                        <h:panelGroup layout="block" style="#{statut.isActeur(murController.idUtilisateur) ? 'display : visible' : 'display : none'}">

                                            <ui:param name="visible" value="#{ps.personne.id == murController.idUtilisateur}" />    

                                            <!-- Boucle action statut -->
                                            <ui:repeat value="#{statut.statutsActeurs}" var="ps">

                                                <!-- If lien statuts -->
                                                <!-- Case action = 0 -->
                                                <h:panelGroup layout="block" style="#{visible and ps.typeAction.id == 0 ? 'display : visible' : 'display : none'} ">
                                                    <h:link value="Léger!" outcome="mur">
                                                        <f:param name="id" value="#{statut.id}" />
                                                        <f:param name="idPersonne" value="#{idDestinataire}" />
                                                    </h:link>
                                                    <h:link value="T'es lourd!" outcome="mur">
                                                        <f:param name="id" value="#{statut.id}" />
                                                        <f:param name="idPersonne" value="#{idDestinataire}" />
                                                    </h:link>
                                                </h:panelGroup> <!-- Fin case action = 0 -->
                                                <!-- Case action = 1 -->
                                                <h:panelGroup layout="block" style="#{visible and ps.typeAction.id == 1 ? 'display : visible' : 'display : none'} ">
                                                    <h:link value="Vous avez allégé le statut." outcome="mur">
                                                        <f:param name="id" value="#{statut.id}" />
                                                        <f:param name="idPersonne" value="#{idDestinataire}" />
                                                    </h:link>
                                                </h:panelGroup><!-- Fin case action = 1 -->
                                                <!-- Case action = 2 -->
                                                <h:panelGroup layout="block" style="#{visible and ps.typeAction.id == 2 ? 'display : visible' : 'display : none'} ">
                                                    <h:link value="Vous avez allourdi le statut." outcome="mur">
                                                        <f:param name="id" value="#{statut.id}" />
                                                        <f:param name="idPersonne" value="#{idDestinataire}" />
                                                    </h:link>
                                                </h:panelGroup><!-- Fin case action = 2 -->
                                                <!-- Fin lien statuts -->
                                            </ui:repeat> <!-- Fin boucle action statut -->

                                        </h:panelGroup> <!-- Fin lien action utilisateur statut -->

                                        <!-- Div lien non action utilisateur statut -->
                                        <h:panelGroup layout="block" style="#{!statut.isActeur(murController.idUtilisateur) ? 'display : visible' : 'display : none'}">
                                            <h:link value="Léger!" outcome="mur">
                                                <f:param name="id" value="#{statut.id}" />
                                                <f:param name="idPersonne" value="#{idDestinataire}" />
                                            </h:link>
                                            <h:link value="T'es lourd!" outcome="mur">
                                                <f:param name="id" value="#{statut.id}" />
                                                <f:param name="idPersonne" value="#{idDestinataire}" />
                                            </h:link>
                                        </h:panelGroup> <!-- Fin div lien non action utilisateur statut -->

                                    </h:panelGroup> <!-- fin div lien not empty action statut-->

                                    <!-- Div lien sans actions statut-->
                                    <h:panelGroup layout="block" style="#{empty statut.statutsActeurs ? 'display : visible' : 'display : none'} ">
                                        <h:link value="Léger!" outcome="mur">
                                            <f:param name="id" value="#{statut.id}" />
                                            <f:param name="idPersonne" value="#{idDestinataire}" />
                                        </h:link>
                                        <h:link value="T'es lourd!" outcome="mur">
                                            <f:param name="id" value="#{statut.id}" />
                                            <f:param name="idPersonne" value="#{idDestinataire}" />
                                        </h:link>
                                    </h:panelGroup> <!-- Fin div lien sans actions statut-->

                                </h:panelGroup><!-- Fin div léger/lourd -->
                                <!-- Boucle sur les commentaires -->
                                <ui:repeat value="#{statut.commentaires}" var="commentaire" >
                                    <!-- Div d'un commentaire -->
                                    <h:panelGroup layout="block" class="commentaires">
                                        <h:outputText value="#{commentaire.auteur.prenom} #{commentaire.auteur.nom}"/>
                                        <h:panelGroup layout="block" class="commentaire-texte">
                                            <h:outputText value="#{commentaire.texte}"/>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block" >
                                            <h:outputText value="#{commentaire.date}"/>
                                        </h:panelGroup>
                                    </h:panelGroup> <!-- Fin div commentaire -->
                                </ui:repeat> <!-- Fin boucle commentaires -->
                            </h:panelGroup><!-- Fin div statut -->
                        </ui:repeat><!-- Fin boucle sur liste des statuts -->
                    </h:panelGroup><!-- Fin div liste statuts -->
                </h:panelGroup><!-- Fin post statut -->
            </h:panelGroup> <!-- Fin row -->
        </h:panelGroup> <!-- Fin div fluid -->
    </h:body>
</html>

